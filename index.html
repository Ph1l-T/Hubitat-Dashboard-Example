<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eletrize</title>
    <!-- Raleway local (ver styles.css @font-face) -->
    <link rel="stylesheet" href="styles.css">
    <!-- PWA: manifest e meta -->
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="theme-color" content="#101010">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="images/photos/EletrizeLogo.jpg">
</head>
<body>

    <!-- SPA root -->
    <div id="spa-root"></div>

    <!-- Navbar fixa SPA -->
    <nav class="navbar" id="spa-navbar">
        <div class="nav-item" data-page="music">
            <div class="nav-icon-wrapper">
                <img src="images/icons/icon-music.svg" alt="Música" class="nav-icon">
            </div>
        </div>
        <div class="nav-item" data-page="confort">
            <div class="nav-icon-wrapper">
                <img src="images/icons/icon-confort.svg" alt="Conforto" class="nav-icon">
            </div>
        </div>
        <div class="nav-item" data-page="home">
            <div class="nav-icon-wrapper">
                <img src="images/icons/icon-home.svg" alt="Home" class="nav-icon">
            </div>
        </div>
        <div class="nav-item" data-page="watch">
            <div class="nav-icon-wrapper">
                <img src="images/icons/icon-watch.svg" alt="Assistir" class="nav-icon">
            </div>
        </div>
        <div class="nav-item" data-page="scenes">
            <div class="nav-icon-wrapper">
                <img src="images/icons/icon-scenes.svg" alt="Cenários" class="nav-icon">
            </div>
        </div>
    </nav>

    <script>
        // Cloud proxy for Hubitat (GitHub Pages / Public)
        window.USE_HUBITAT_PROXY = true;
        window.HUBITAT_PROXY_BASE_URL = 'https://hubitat-proxy.philipe2017s.workers.dev/hubitat/devices/';
    </script>
    <script src="script.js"></script>
    <script>
    // --- SPA Core ---
    const spaRoot = document.getElementById('spa-root');
    const pages = {
        music: () => `
            <main class="container"><div class="page active"><h1 class="page-title">Música</h1><div style="color:#bbb;text-align:center;margin-top:40px;">Página de Música em construção.</div></div></main>
        `,
        confort: () => `
            <main class="container"><div class="page active"><h1 class="page-title">Conforto</h1><div style="color:#bbb;text-align:center;margin-top:40px;">Página de conforto em construção.</div></div></main>
        `,
        watch: () => `
            <main class="container"><div class="page active"><h1 class="page-title">Assistir</h1><div style="color:#bbb;text-align:center;margin-top:40px;">Página de assistir em construção.</div></div></main>
        `,
        scenes: () => `
            <main class="container"><div class="page active"><h1 class="page-title">Cenários</h1><div style="color:#bbb;text-align:center;margin-top:40px;">Página de Cenários em construção.</div></div></main>
        `,
        home: () => `
            <div class="top-bar-custom"></div>
            <main class="container">
                <div class="page active" id="home-page">
                    <h1 class="page-title">Home</h1>
                    <div class="rooms-frame">
                        <div class="rooms-list">
                            <!-- 1) Escritório -->
                            <div class="room-card">
                                <img src="images/photos/Escritorio-photo.png" alt="Escritório">
                                <span>Escritório</span>
                                <div class="room-icons-row" style="z-index:11; position:relative;">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="133,134" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('escritorio')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                            <!-- 2) Projetos -->
                            <div class="room-card">
                                <img src="images/photos/projetos-photo.png" alt="Projetos">
                                <span>Projetos</span>
                                <div class="room-icons-row">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="140" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('projetos')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                            <!-- 3) Programação -->
                            <div class="room-card">
                                <img src="images/photos/programacao-photo.png" alt="Programação">
                                <span>Programação</span>
                                <div class="room-icons-row">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="139,142" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('programacao')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                            <!-- 4) Sinuca -->
                            <div class="room-card">
                                <img src="images/photos/sinuca-photo.png" alt="Sinuca">
                                <span>Sinuca</span>
                                <div class="room-icons-row">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="138" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('sinuca')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                            <!-- 5) Gourmet -->
                            <div class="room-card">
                                <img src="images/photos/gourmet-photo.png" alt="Gourmet">
                                <span>Gourmet</span>
                                <div class="room-icons-row">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="137" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('gourmet')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                            <!-- 6) Home (ambiente) -->
                            <div class="room-card">
                                <img src="images/photos/home-photo.png" alt="Home">
                                <span>Home</span>
                                <div class="room-icons-row">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="143,146" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('home_env')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                            <!-- 7) Eletrize Solar -->
                            <div class="room-card">
                                <img src="images/photos/eletrize-solar-photo.png" alt="Eletrize Solar">
                                <span>Eletrize Solar</span>
                                <div class="room-icons-row">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="141,144" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('eletrize_solar')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                            <!-- 8) Cinema -->
                            <div class="room-card">
                                <img src="images/photos/cinema-photo.png" alt="Cinema">
                                <span>Cinema</span>
                                <div class="room-icons-row">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="135" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('cinema')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                            <!-- 9) Recepção -->
                            <div class="room-card">
                                <img src="images/photos/recepcao-photo.png" alt="Recepção">
                                <span>Recepção</span>
                                <div class="room-icons-row">
                                    <div style="width: 100%; height: 100%; justify-content: flex-start; align-items: flex-start; gap: 35px; display: inline-flex">
                                        <div class="icon-toggle-light" data-state="off" data-device-ids="136,145,147" onclick="toggleLightIcon(this)" style="width: 42px; height: 42px; position: relative; cursor: pointer;">
                                            <img src="images/icons/icon-small-light-off.svg" alt="Luz" style="width: 100%; height: 100%; object-fit: contain; position: absolute; left: 0; top: 0;" />
                                        </div>
                                    </div>
                                </div>
                                <button class="room-card-link" onclick="spaNavigate('recepcao')" style="position:absolute;left:0;top:0;width:100%;height:100%;z-index:10;background:transparent;border:none;cursor:pointer;"></button>
                            </div>

                        </div>
                    </div>
                </div>
            </main>
        `,

        escritorio: () => `
<div class="page active page-container" style="background-image: url('images/photos/Escritorio-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Escritório</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" data-state="off" data-device-id="134" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Pendente</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small" data-state="off" data-device-id="133" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Trilho</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card large thermostat" id="thermostat">
            <div class="thermostat-display">
                <span id="current-temp">22</span>&deg;C
            </div>
            <div class="thermostat-buttons">
                <div class="temp-decrease" id="temp-decrease"></div>
                <div class="temp-increase" id="temp-increase"></div>
            </div>
        </div>
        <div class="control-card large" data-state="off" onclick="toggleDevice(this, 'tv')">
            <img src="images/icons/icon-small-tv-off.svg" class="control-icon">
            <div class="control-label">Televisão</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card large" data-state="closed" onclick="toggleDevice(this, 'shader')">
            <img src="images/icons/icon-small-shader-off.svg" class="control-icon">
            <div class="control-label">Cortinas</div>
            <div class="control-state">Fechadas</div>
        </div>
        <div class="control-card small dvr">
            <img src="images/icons/icon-watch.svg" class="control-icon">
            <div class="control-label">DVR I</div>
        </div>
        <div class="control-card small dvr">
            <img src="images/icons/icon-watch.svg" class="control-icon">
            <div class="control-label">DVR II</div>
        </div>
    </div>
</div>
        `,

        projetos: () => `
<div class="page active page-container" style="background-image: url('images/photos/projetos-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Projetos</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" data-state="off" data-device-id="140" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Luz Ambiente</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Projeto 2</div>
        </div>
        <div class="control-card small">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Projeto 3</div>
        </div>
    </div>
</div>
        `,

        cinema: () => `
<div class="page active page-container" style="background-image: url('images/photos/cinema-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Cinema</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card large" data-state="off" onclick="toggleDevice(this, 'tv')">
            <img src="images/icons/icon-small-tv-off.svg" class="control-icon">
            <div class="control-label">TV</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small" data-state="off" data-device-id="135" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Luz Ambiente</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small" data-state="closed" onclick="toggleDevice(this, 'shader')">
            <img src="images/icons/icon-small-shader-off.svg" class="control-icon">
            <div class="control-label">Cortinas</div>
            <div class="control-state">Fechadas</div>
        </div>
    </div>
</div>
        `,

        recepcao: () => `
<div class="page active page-container" style="background-image: url('images/photos/recepcao-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Recepção</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" data-state="off" data-device-id="136" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Luz Ambiente</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small" data-state="off" data-device-id="145" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Barra LED</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small" data-state="off" data-device-id="147" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Lustre</div>
            <div class="control-state">OFF</div>
        </div>
    </div>
</div>
        `,

        gourmet: () => `
<div class="page active page-container" style="background-image: url('images/photos/gourmet-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Gourmet</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" data-state="off" data-device-id="137" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Luz Ambiente</div>
            <div class="control-state">OFF</div>
        </div>
    </div>
</div>
        `,

        sinuca: () => `
<div class="page active page-container" style="background-image: url('images/photos/sinuca-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Sinuca</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" data-state="off" data-device-id="138" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Luz Ambiente</div>
            <div class="control-state">OFF</div>
        </div>
    </div>
</div>
        `,

        programacao: () => `
<div class="page active page-container" style="background-image: url('images/photos/programacao-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Programação</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" data-state="off" data-device-id="139" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Lustre</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small" data-state="off" data-device-id="142" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Rack</div>
            <div class="control-state">OFF</div>
        </div>
    </div>
</div>
        `,

        controle_tv: () => `
<div class="page active page-container" style="background-image: url('images/photos/programacao-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('programacao')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Controle TV</h1>
    </div>
    <div class="remote-wrapper">
        <div class="remote" id="tv-remote" data-tv-id="149">
            <!-- Apenas botões funcionais -->
            <div class="area-top left-top two-cols">
                <button class="remote-btn btn-std power" data-cmd="power" onclick="handleRemoteClick(this)">⏻</button>
                <button class="remote-btn btn-std" data-cmd="mute" onclick="handleRemoteClick(this)">MUTE</button>
            </div>

            <!-- VOL/CH lado a lado -->
            <div class="area-vol side-block">
                <div class="side-label">VOL</div>
                <button class="remote-btn side" data-cmd="volUp" onclick="handleRemoteClick(this)">+</button>
                <button class="remote-btn side" data-cmd="volDown" onclick="handleRemoteClick(this)">−</button>
            </div>
            <div class="area-ch side-block">
                <div class="side-label">CH</div>
                <button class="remote-btn side" data-cmd="chUp" onclick="handleRemoteClick(this)">+</button>
                <button class="remote-btn side" data-cmd="chDown" onclick="handleRemoteClick(this)">−</button>
            </div>
        </div>
    </div>
</div>
        `,

        ar_condicionado: () => `
<div class="page active page-container" style="background-image: url('images/photos/programacao-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('programacao')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Ar Condicionado</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" onclick="acSetPower(165, true)">
            <img src="images/icons/icon-small-light-on.svg" class="control-icon">
            <div class="control-label">Ligar</div>
        </div>
        <div class="control-card small" onclick="acSetPower(165, false)">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Desligar</div>
        </div>

        <div class="control-card small" onclick="acSetMode(165, 'auto')">
            <div class="control-label">Modo Auto</div>
        </div>
        <div class="control-card small" onclick="acSetMode(165, 'cool')">
            <div class="control-label">Modo Frio</div>
        </div>
        <div class="control-card small" onclick="acSetMode(165, 'heat')">
            <div class="control-label">Modo Quente</div>
        </div>

        <div class="control-card small" onclick="acSetFanMode(165, 'auto')">
            <div class="control-label">Vent Auto</div>
        </div>
        <div class="control-card small" onclick="acSetFanMode(165, 'on')">
            <div class="control-label">Vent On</div>
        </div>

        <div class="control-card large">
            <div class="control-label">Setpoint</div>
            <div class="thermostat-display" id="ac-setpoint-display" data-device-id="165">20°C</div>
        </div>
        <div class="control-card small" onclick="acAdjustCoolingSetpoint(165, -1)">
            <div class="control-label">Temp −</div>
        </div>
        <div class="control-card small" onclick="acAdjustCoolingSetpoint(165, 1)">
            <div class="control-label">Temp +</div>
        </div>
    </div>
</div>
        `,

        eletrize_solar: () => `
<div class="page active page-container" style="background-image: url('images/photos/eletrize-solar-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Eletrize Solar</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" data-state="off" data-device-id="141" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Luz Ambiente</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small" data-state="off" data-device-id="144" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Balizadores</div>
            <div class="control-state">OFF</div>
        </div>
    </div>
</div>
        `,

        home_env: () => `
<div class="page active page-container" style="background-image: url('images/photos/home-photo.png');">
    <div class="page-header">
        <button class="back-btn" onclick="spaNavigate('home')"><img src="images/icons/icon-backbutton.svg" alt="Voltar"></button>
        <h1 class="page-title">Home</h1>
    </div>
    <div class="controls-grid">
        <div class="control-card small" data-state="off" data-device-id="143" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Luz Ambiente</div>
            <div class="control-state">OFF</div>
        </div>
        <div class="control-card small" data-state="off" data-device-id="146" onclick="toggleDevice(this, 'light')">
            <img src="images/icons/icon-small-light-off.svg" class="control-icon">
            <div class="control-label">Lustre</div>
            <div class="control-state">OFF</div>
        </div>
    </div>
</div>
        `
    };

    function spaNavigate(page) {
        window.location.hash = page;
    }

    function renderSpa() {
        let page = window.location.hash.replace('#', '') || 'home';
        if (!pages[page]) page = 'home';
        spaRoot.innerHTML = pages[page]();

        // Atualiza navbar
        const nav = document.getElementById('spa-navbar');
        const items = nav.querySelectorAll('.nav-item');
        const navPages = Array.from(items).map(i => i.getAttribute('data-page'));

        // Mantém o Home ativo para Páginas que não estão na navbar (cômodos)
        const navPage = navPages.includes(page) ? page : 'home';
        let activeIndex = navPages.indexOf(navPage);
        if (activeIndex < 0) activeIndex = navPages.indexOf('home');

        items.forEach((item, idx) => {
            item.classList.toggle('active', idx === activeIndex);
        });

        // Move indicador (bolinha) dinamicamente
        const activeItem = items[activeIndex];
        if (activeItem) {
            const navRect = nav.getBoundingClientRect();
            const itemRect = activeItem.getBoundingClientRect();
            const center = itemRect.left + itemRect.width / 2 - navRect.left;
            nav.style.setProperty('--indicator-left', `${center}px`);
        }

        // Inicializa componentes específicos da Página
        if (page === 'escritorio') {
            setupThermostat();
        }

        // Sincroniza estados reais dos dispositivos após montar a página
        if (typeof syncAllElementsFromCache === 'function') { try { syncAllElementsFromCache(); } catch (e) { console.error('Falha ao aplicar cache apos render', e); } }
        if (typeof refreshAllDeviceStates === 'function') {
            try { refreshAllDeviceStates(true); } catch (e) { console.error('Falha ao sincronizar após render', e); }
        }
    }

    window.addEventListener('hashchange', renderSpa);
    window.addEventListener('DOMContentLoaded', () => {
        renderSpa();
        // Navbar SPA - garantir que listeners são aplicados após DOM pronto
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                const page = item.getAttribute('data-page');
                if (page) {
                    e.preventDefault();
                    spaNavigate(page);
                }
            });
        });
    });
    </script>
</body>
</html>


